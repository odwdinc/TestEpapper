<!DOCTYPE html>
<html>

<head>


<script
  src="https://code.jquery.com/jquery-3.4.1.slim.js"
  integrity="sha256-BTlTdQO9/fascB1drekrDVkaKd9PkwBymMlHOiG+qLI="
  crossorigin="anonymous"></script>

<script language="JavaScript" type="text/javascript">

var ElementList ={}

function myFunction() {
  	console.log('Requesting Bluetooth Device...');
	navigator.bluetooth.requestDevice({
  		filters: [{
    		services: ['19b10000-e8f2-537e-4f6c-d104768a1214']
  		}]
	})
	.then(device => {
    	console.log('Connecting to GATT Server...');
    	return device.gatt.connect();
	})
	.then(server => {
		console.log('Getting Service...');
		return server.getPrimaryService('19b10000-e8f2-537e-4f6c-d104768a1214');
	})
	.then(service => {
		console.log('Getting Characteristics...');
		// Get all characteristics.
		return service.getCharacteristics();
	})
	.then(characteristics => {
		characteristics.forEach(function(element) {
			console.log('> Characteristic: ');
		  	console.log(element.uuid);
		  	console.log('Getting Descriptor...');
    		element.getDescriptor('gatt.characteristic_user_description').
    		then(descriptor => {
    			ElementList[element.uuid] = descriptor;
    			document.querySelector('#Button_'+uuid).disabled = !descriptor.characteristic.properties.write;
    			return descriptor.readValue();
    		}).then(value => {
    			let decoder = new TextDecoder('utf-8');
    			console.log('> Characteristic User Description: ' + decoder.decode(value));
    		}).catch(error => {
				console.log('Characteristic Argh! ' + error);
			});
		});
		return 0;
	})
	.then(val =>{

	})
	.catch(error => {
		console.log('Argh! ' + error);
	});
}
</script>
</head>
<body>

<h1>The BLE Event</h1>


<button onclick="myFunction()">Click me</button>

<p id="demo"></p>

<button id="Button_19b10001-e8f2-537e-4f6c-d104768a1214" disabled>On/Off</button>
<button id="Button_19b10002-e8f2-537e-4f6c-d104768a1214" disabled>Brightness</button>
<button id="Button_19b10003-e8f2-537e-4f6c-d104768a1214" disabled>Rainbow On/Off</button>
<button id="Button_19b10004-e8f2-537e-4f6c-d104768a1214" disabled>Set Color</button>
</body>
</html>
